<!doctype html>
<html lang="en">
  <head>
    <title>COVID-19 Lab Finder&mdash; Website Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    
    
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700, 900|Vollkorn:400i" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static',filename='fonts/icomoon/style.css') }}">

    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/jquery-ui.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/owl.carousel.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/owl.theme.default.min.css') }}">
    
    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/jquery.fancybox.min.css') }}">

    
    <!-- <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css"> -->
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='fonts/font-awesome-4.7.0/css/font-awesome.min.css') }}">

    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/aos.css') }}">

    <link rel="stylesheet" href="{{ url_for('static',filename='css/vendor/bootstrap/css/style.css') }}">
    <!--===============================================================================================-->	
    
    <link rel= "icon" type= "image/png" href= "{{ url_for('static',filename='images/icons/favicon.ico') }}">
<!--===============================================================================================-->
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='fonts/font-awesome-4.7.0/css/font-awesome.min.css') }}">
<!--===============================================================================================-->
	
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/vendor/bootstrap/css/bootstrap.min.css') }}">
<!--===============================================================================================-->
    
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/vendor/animate/animate.css') }}">
<!--===============================================================================================-->
   
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/vendor/select2/select2.min.css') }}">
<!--===============================================================================================-->
    
    
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/vendor/select2/select2.min.css') }}">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/vendor/perfect-scrollbar/perfect-scrollbar.css') }}">
<!--===============================================================================================-->
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/util.css') }}">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/main.css') }}">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/jquery-1.12.4.js"></script>
  <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <style>
    /* Set the size of the div element that contains the map */
   #map {
     height: 400px;  /* The height is 400 pixels */
     width: 100%;  /* The width is the width of the web page */
    }
 </style>
  </head>
  <body data-spy="scroll" data-target=".site-navbar-target" data-offset="300" id="home-section">
  

  <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>


  <div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
   
    
    <header class="site-navbar js-sticky-header site-navbar-target" role="banner" >

      <div class="container">
        <div class="row align-items-center">
          
          <div class="col-6 col-xl-6">
            <h1 class="mb-0"><a href="index" class="h2 mb-0">COVID-19 Testing Labs US<sup>*</sup><span class="text-primary">.</span> </a></h1>
          </div>

          <div class="col-6 col-md-6 d-none d-xl-block">
            <nav class="site-navigation position-relative text-right" role="navigation">

              <ul class="site-menu main-menu js-clone-nav mr-auto d-none d-lg-block">
                <li><a href="#home-section" class="nav-link">Home</a></li>
                <li><a href="#trainers-section" class="nav-link">Disclaimer</a></li>
                <li><a href="#contact-section" class="nav-link">Refrence</a></li>
              </ul>
            </nav>
          </div>


          <div class="col-6 d-inline-block d-xl-none ml-md-0 py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle float-right"><span class="icon-menu h3"></span></a></div>

        </div>
      </div>
      
    </header>

  
    <section class="site-section">
      <div class="container">
        <div class="row">
          <div class="col-md-12 align-self-center text-center text-md-left">
            <div id="map">
              
            </div>
            <form>
              <fieldset>
              <legend class="p-1">Select State and City</legend>
              <p>
                  <label>Select State</label>
                  <select id = "stateList">
                      <option value="0">Select</option>
                  </select>
                  <label class="p-1">Select City</label>
                  <select id = "cityList" disabled >
                  
                  </select>
              </p>
              </fieldset>
          </form>
          </div>
    
        </div>
      </div>
    
      <div class="container">
        <div class="table100 ver1 m-b-110">
          <div class="table100-head">
              <table>
                  <thead>
                      <tr class="row100 head">
                          <th class="cell100 column1">Laboratory Name</th>
                          <th class="cell100 column2">State</th> 
                          <th class="cell100 column3">Address</th>
                          <th class="cell100 column4">City</th>
                          <!-- <th class="cell100 column5">Zip</th>  -->
                          <!-- <th class="cell100 column4">Map</th> -->
                      </tr>
                  </thead>
              </table>
          </div>
          <div class="table100-body js-pscroll">
              <table id="records_table">
                  
              </table>
          </div>
      </div>
    </section>

    <section class="site-section" id="trainers-section">
      <div class="container">
        <div class="row justify-content-center" data-aos="fade-up">
          <div class="col-lg-6 align-self-center mr-auto text-left heading-section mb-6">
            
            <h2 class="text-black mb-3">Disclaimer</h2>
            <p class="lead">This website is provided as a service to the public. Site creator not responsible for, and expressly disclaims all liability for, damages of any kind arising out of use, reference to, or reliance on any information contained within this website.
              While the information contained within this website is periodically updated, no guarantee is given that the information provided in this website is correct, complete, and up-to-date.
              Although this website may include links providing direct access to other Internet resources, including websites, site creator not responsible for the accuracy or content of information contained in these sites.</p>
            
            
          </div>
         
        </div>
      </div>
    </section>


    
    
    <section class="" id="contact-section">
      <div class="container">
        <div class="row justify-content-center" data-aos="fade-up">
          <div class="col-lg-12 align-self-center mr-auto text-left heading-section mb-12">
            
            <h2 class="text-black mb-3">Reference</h2>
            <!-- <p class="lead">Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
            <p class="text-muted mb-4">A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p> -->
            <ul class="list-unstyled ul-paw primary mb-0">
              <li><a href='https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/testing-in-us.html'>https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/testing-in-us.html</a></li>
              <li><a href='https://www.aphl.org/programs/preparedness/Crisis-Management/Pages/2019-nCoV.aspx'>https://www.aphl.org/programs/preparedness/Crisis-Management/Pages/2019-nCoV.aspx</a></li>
              <li><a href='https://www.aphl.org/programs/preparedness/Crisis-Management/Documents/CLIA%20COC%20and%20COA%20Labs%20w_Virology_Subspecialty_3-6-2020.xlsx'>https://www.aphl.org/programs/preparedness/Crisis-Management/Documents/CLIA%20COC%20and%20COA%20Labs%20w_Virology_Subspecialty_3-6-2020.xlsx</a></li>
            </ul>
            
          </div>
         
        </div>
      </div>
    </section>
    
    
    <footer class="site-footer">
      <div class="container">
        
        <div class="row pt-5 mt-5 text-center">
          <div class="col-md-12">
            <div class="border-top pt-5">
              <p class="copyright"><small>
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart text-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></small></p>
        
            </div>
          </div>
          
        </div>
      </div>
    </footer>

  </div> <!-- .site-wrap -->

  <script src="{{ url_for('static',filename='scripts/jquery-3.3.1.min.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/jquery-ui.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/popper.min.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/bootstrap.min.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/owl.carousel.min.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/jquery.countdown.min.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/jquery.easing.1.3.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/aos.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/jquery.fancybox.min.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/jquery.sticky.js') }}"></script>
  <script src="{{ url_for('static',filename='scripts/isotope.pkgd.min.js') }}"></script>

  
  <script src="{{ url_for('static',filename='scripts/main_new.js') }}"></script>

  
  </body>
  <script>
    // Initialize and add the map
    function initMap() {
      //center of USA LEbanon,KS
      //39.8097, -98.5556
      var center = {lat: 39.8097, lng: -98.5556};
      // The location of altlanta
      
      var atlanta = {lat: 33.7490, lng: -84.3880};
      ////41.8781,87.6298
      var chicago = {lat: 41.8781, lng: -87.6298};
      
      // The map, centered at atlanta
      var map = new google.maps.Map(
          document.getElementById('map'), {zoom: 4, center: center});
      // The marker, positioned at Uluru
      var marker = new google.maps.Marker({position: atlanta, map: map,title:'CDC'});
    //   var marker = new google.maps.Marker({position: chicago, map: map});
    }

    function updateMap(pin_marker_collection) {
        //center of USA LEbanon,KS
        //39.8097, -98.5556
        var center =pin_marker_collection[0];
        
        var map = new google.maps.Map(
            document.getElementById('map'), {zoom: 5, center: center});
        //Create LatLngBounds object.
        var latlngbounds = new google.maps.LatLngBounds();
        //Used by click listner
        var infoWindow = new google.maps.InfoWindow();
        pin_marker_collection.forEach(element => {
            var latlng = new google.maps.LatLng(element.lat, element.lng);
            var marker = new google.maps.Marker({position: latlng, map: map,title:element.title});
            
            (function (marker, element) {
                console.log(element)
                google.maps.event.addListener(marker, "click", function (e) {
                    infoWindow.setContent("<div style = 'width:200px;min-height:40px'>" + element.title +"<br/>"+element.address +"</br>"+element.directions+"</div>");
                    infoWindow.open(map, marker);
                });
            })(marker, element);

            latlngbounds.extend(marker.position);
        });

        //Center map and adjust Zoom based on the position of all markers.
        map.setCenter(latlngbounds.getCenter());
        map.fitBounds(latlngbounds);
    }    
        
    $(function() {
        $( "#autocity" ).focusout(function(event,data) {
            console.log($("#autocity").val())
            city = $("#autocity").val();
            if(city){
                populateCityData(city)
            }
        });
        $( "#stateList" ).focusout(function(event,data) {
            console.log($("#stateList").val())
            st = $("#stateList").val();
            if(st){
                handleCity(st)
            }
        });
       
        // function disableClick() {
        //     $("a").click(function(e) {
            
        //     e.stopImmediatePropagation();
        
        //     console.log("a clicked");
        //     // $( "<div>" )
        //     //     .append( "default " + event.type + " prevented" )
        //     //     .appendTo( "#log" );
        //     return false;
        //     });
        // }
      
        function showMap(address) {
            console.log(address);
            $("#locMap").src = address;
        }

        function populateCityData(city,state) {
            console.log(city);
            data = JSON.stringify({'state': state, 'city': city})
    
            if(city){
                $.ajax({
                dataType: 'json',
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/getlist",
                data: data,
                success: function (response) {
                    // console.log(response.results)
                    var trHTML = '';
                    $('#records_table tr').remove()
                    pin_marker_collection =[]
                    $.each(response, function (i, item) {
                        // trHTML += "<thead><td>Laboratory Name</td><td>City</td><td>State</td></thead>";
                        $.each(item,function (i, row){
                            address = row["Laboratory Name"]+","+row["City"]+","+row["State"]
                            latitude = row["lat"]
                            longitude = row ["lng"]
                            directions = "<a href=https://www.google.com/maps/search/?api=1&query="+encodeURI(row["Formatted_address"])+">Directions</a>";
                            if(latitude && longitude){
                                
                                pin_marker =  {lat: latitude, lng: longitude, title:row["Laboratory Name"],address:row["Formatted_address"],directions:directions}
                                pin_marker_collection.push(pin_marker); 
                            }
                            // google = encodeURI('https://maps.googleapis.com/maps/api/staticmap?center="'+address+'"&zoom=14&size=400x400&key=AIzaSyDYnBx8lUCLmIeOp7lF4Q1vv32tfUH-S44');
                            // console.log(google)
                            
                            trHTML += '<tr class="row100 body"><td class="cell100 column1">' + row["Laboratory Name"]+ '</td><td class="cell100 column2">' + row["State"] +'</td><td class="cell100 column3">' + row["Formatted_address"] + '</td><td class="cell100 column4">' + row["City"] + '</td>';
                            // trHTML +="<td class='cell100 column5'><a href='"+google+"' onclick='disableClick()' >Directions</a></td>"
                            // trHTML += '<td class="cell100 column5">' + row["Zip_code"] +'</td>'
                            trHTML +="</tr>";
                        });
                        
                        
                    });
                    $('#records_table').append(trHTML);
                    updateMap(pin_marker_collection); 
                }
                
                });
            }
            
        }

        $(document).ready(function(){
            // disableClick();
        });

        function handleCity(params) {
            // console.log(params.item.label);
            if(params){
                $.ajax({
                url: '/getcityfromstate?state='+params
                }).done(function (data) {
                    // console.log(data)
                    $('#cityList').empty()
                    $('#cityList').prop("disabled", false);
                    populateCitySelect(data.results);
                });
            }
            
        }
        function handleState(city) {
            // console.log(params.item.label);
            if(params){
                $.ajax({
                url: '/getcityfromstate?state='+params
                }).done(function (data) {
                    // console.log(data)
                    $('#cityList').empty()
                    populateCitySelect(data.results);
                });
            }
            
        }
        $.ajax({
            url: '/getcity?city=ALL'
            }).done(function (data) {
                // console.log(data)
                populateCitySelect(data.results);
            });
        
        

        function populateStateSelect(items) {
            $.each(items, function (i, item) {
            console.log(item)
            $('#stateList').append($('<option>', { 
                value: item,
                text : item
                }));
            });
        }

        $( "#cityList" ).change(function() {
            city = $("#cityList").val();
            state = $("#stateList").val();
            
            if(city&&state){
                populateCityData(city,state)
            }
        });

        $( "#stateList" ).change(function() {
            console.log($("#stateList").val())
            st = $("#stateList").val();
            if(st){
                handleCity(st)
            }
        });

        function populateCitySelect(items) {
            
            $('#cityList').append($('<option>', { 
                value: "0",
                text : "Select"
            }));
            $.each(items, function (i, item) {
            // console.log(item)
            $('#cityList').append($('<option>', { 
                value: item,
                text : item
                }));
            });
        }

        $.ajax({
        url: '/getstate?state=ALL'
        }).done(function (data) {
            console.log(data)
            
            populateStateSelect(data.results);
        });

        $.curCSS = function (element, attrib, val) {
            $(element).css(attrib, val);
        };
        });
</script>
<!--Load the API from the specified URL
* The async attribute allows the browser to render the page while the API loads
* The key parameter will contain your own API key (which is not needed for this tutorial)
* The callback parameter executes the initMap() function
-->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVTNW2QjhnjmptFTP-fmpJdCEKtyJMNYo&callback=initMap">
</script>
</html>